plugins {
    id("com.android.application")
    id("org.jetbrains.kotlin.android") version "1.9.23"
    id("com.facebook.react")
}

android {
    namespace "com.example.sistemdesamobile"
    ndkVersion = "26.1.10909125"
    compileSdkVersion = 34
    buildToolsVersion = "35.0.0"

    defaultConfig {
        applicationId "com.example.sistemdesamobile"
        minSdk = 24
        targetSdk = 34
        versionCode 1
        versionName "1.0"
        
        // This is the key change. We are now explicitly enabling the New Architecture.
        // This will ensure the required native libraries, like "libreact_featureflagsjni.so",
        // are included in your build, resolving the UnsatisfiedLinkError.
        buildConfigField "boolean", "IS_NEW_ARCHITECTURE_ENABLED", "true"
        buildConfigField "boolean", "IS_HERMES_ENABLED", "true"
    }

    buildFeatures {
        buildConfig = true
        // Enabling the new architecture also requires a different way of referencing
        // the React Native build features. The react { } block handles this automatically.
    }

    signingConfigs {
        debug {
            storeFile file("debug.keystore")
            storePassword "android"
            keyAlias "androiddebugkey"
            keyPassword "android"
        }
    }

    buildTypes {
        debug {
            signingConfig signingConfigs.debug
        }
        release {
            signingConfig signingConfigs.debug
            shrinkResources false
            minifyEnabled false
            proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
        }
    }

    packagingOptions {
        jniLibs {
            useLegacyPackaging = false
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_17
        targetCompatibility JavaVersion.VERSION_17
    }
    kotlinOptions {
        jvmTarget = "17"
    }
}

// We'll let the react plugin manage the dependencies for Hermes and the new architecture.
dependencies {
    implementation("com.facebook.react:react-android")
    
    // The following dependencies are correctly configured, no changes needed.
    implementation("androidx.core:core-splashscreen:1.0.0")
    implementation("com.google.android.material:material:1.12.0")
    implementation("androidx.appcompat:appcompat:1.7.0")
    implementation("androidx.core:core-ktx:1.13.1")
    implementation("com.facebook.react:react-android")
    implementation("com.facebook.react:hermes-android")
}

afterEvaluate {
    def bundleTask = tasks.findByName("createBundleReleaseJsAndAssets")
    def mergeResTask = tasks.findByName("mergeReleaseResources")
    if (bundleTask != null && mergeResTask != null) {
        mergeResTask.dependsOn(bundleTask)
    }
    tasks.findByName("generateAutolinkingPackageList")?.enabled = false
}

project.ext.react = [
    enableNewArch: true,
    enableHermes: false,
    enableVmCleanup: false,
]
